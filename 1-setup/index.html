<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <meta name="author" content="Ivan Pepelnjak, ipSpace.net AG">
        <link rel="canonical" href="https://evpn.bgplabs.net/1-setup/">
        <link rel="shortcut icon" href="../img/favicon.ico">
  <title>Installation and Setup &#171; VXLAN and EVPN Labs</title>
        <link href="../css/bootstrap.min.css" rel="stylesheet">
        <link href="../css/fontawesome.min.css" rel="stylesheet">
        <link href="../css/brands.min.css" rel="stylesheet">
        <link href="../css/solid.min.css" rel="stylesheet">
        <link href="../css/v4-font-face.min.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link id="hljs-light" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" >
        <link id="hljs-dark" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github-dark.min.css" disabled>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script>hljs.highlightAll();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="..">VXLAN and EVPN Labs</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbar-collapse" aria-controls="navbar-collapse" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"  aria-expanded="false">Home</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href=".." class="dropdown-item">Labs Overview</a>
</li>
                                    
<li>
    <a href="../3-upcoming/" class="dropdown-item">Upcoming Labs</a>
</li>
                                    
<li>
    <a href="../99-about/" class="dropdown-item">About the Project</a>
</li>
                                </ul>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle active" aria-current="page" role="button" data-bs-toggle="dropdown"  aria-expanded="false">Installation</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="./" class="dropdown-item active" aria-current="page">Installation and Setup</a>
</li>
                                    
<li>
    <a href="../4-codespaces/" class="dropdown-item">Use GitHub Codespaces</a>
</li>
                                </ul>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"  aria-expanded="false">VXLAN</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../vxlan/1-single/" class="dropdown-item">Extend a Single VLAN Segment with VXLAN</a>
</li>
                                    
<li>
    <a href="../vxlan/2-complex/" class="dropdown-item">More Complex VXLAN Deployment Scenario</a>
</li>
                                    
<li>
    <a href="../vxlan/3-irb/" class="dropdown-item">Routing between VXLAN Segments</a>
</li>
                                    
<li>
    <a href="../vxlan/4-anycast/" class="dropdown-item">Anycast Gateways on VXLAN Segments</a>
</li>
                                    
<li>
    <a href="../vxlan/5-vrf-lite/" class="dropdown-item">Implement VRF-Lite with VXLAN</a>
</li>
                                </ul>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"  aria-expanded="false">EVPN</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../evpn/1-bridging/" class="dropdown-item">Build an EVPN-based MAC-VRF instance</a>
</li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ms-md-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-bs-toggle="modal" data-bs-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../99-about/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../4-codespaces/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>

                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3">
<div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
  <div class="navbar-header">
      <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
          <span class="fa fa-angle-down"></span>
      </button>
  </div>

  
  
  
  
  
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary"  style="margin-bottom: 1em;">
      <ul class="nav flex-column">
          
      <li class="nav-item" data-level="1"><a href="#software-installation-and-lab-setup" class="nav-link">Software Installation and Lab Setup</a>
        <ul class="nav flex-column">
      <li class="nav-item" data-level="2"><a href="#devs" class="nav-link">Select the Network Devices You Will Work With</a>
        <ul class="nav flex-column">
        </ul>
      </li>
      <li class="nav-item" data-level="2"><a href="#extradev" class="nav-link">Select the Additional Devices in Your Lab</a>
        <ul class="nav flex-column">
        </ul>
      </li>
      <li class="nav-item" data-level="2"><a href="#select-the-virtualization-environment" class="nav-link">Select the Virtualization Environment</a>
        <ul class="nav flex-column">
        </ul>
      </li>
      <li class="nav-item" data-level="2"><a href="#software-installation" class="nav-link">Software Installation</a>
        <ul class="nav flex-column">
        </ul>
      </li>
      <li class="nav-item" data-level="2"><a href="#defaults" class="nav-link">Setting Up the Labs</a>
        <ul class="nav flex-column">
        </ul>
      </li>
        </ul>
      </li>
      </ul>
    </div>
  
  
  
  
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="software-installation-and-lab-setup">Software Installation and Lab Setup</h1>
<p>It&rsquo;s easiest to use the VXLAN/EVPN labs with <em><a href="https://netlab.tools/">netlab</a></em>. While you can use most of them (with reduced functionality) with any other virtual or physical lab environment, we&rsquo;ll assume you decided to use <em>netlab</em>; if you want to set up your lab in some other way, read the <a href="https://bgplabs.net/external/">Manual Setup</a> section of the BGP Labs documentation.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>EVPN labs work best with <em>netlab</em> release 25.10 or later (some lab exercises require a more recent <em>netlab</em> release). If you&rsquo;re using an earlier release, please upgrade with <code>pip3 install --upgrade networklab</code>.</p>
</div>
<h2 id="devs">Select the Network Devices You Will Work With</h2>
<p>While I usually recommend FRRouting as the simplest-to-deploy network device, FRRouting does not include data-plane VLAN, VXLAN, or anycast gateway configuration. Configuring underlying Linux devices is too complex for an entry-level VXLAN/EVPN  exercise; you&rsquo;ll be better off using one of the other platforms for which we implemented <a href="https://netlab.tools/module/vxlan/#platform-support">VXLAN</a> and <a href="https://netlab.tools/module/evpn/#platform-support">EVPN</a> functionality.</p>
<p>You can run Arista EOS in all <a href="https://netlab.tools/providers/"><em>netlab</em>-supported virtualization environments</a> (libvirt virtual machines or Docker containers), and if you want to start practicing VXLAN and EVPN with minimum hassle, consider using Arista EOS for all lab devices. While most network devices require an x86 CPU, you can run Arista cEOS or Nokia SR Linux containers on <a href="https://blog.ipspace.net/2024/03/netlab-bgp-apple-silicon.html">MacBooks with Apple silicon</a>.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>If you plan to run the labs in <a href="../4-codespaces/">free GitHub Codespaces</a>, you MUST use container-based network devices, such as Arista cEOS or Nokia SR Linux. Furthermore, the device cannot rely on the Linux VXLAN kernel module (FRRouting and VyOS do).</p>
</div>
<h2 id="extradev">Select the Additional Devices in Your Lab</h2>
<p>Some labs use additional switches &ndash; preconfigured devices with which your switches exchange EVPN routes. You won&rsquo;t configure those devices, but you might need to log into them and execute <strong>show</strong> commands.</p>
<p>The default setup uses Arista EOS on the lab switches and FRRouting on the external/core routers. All the <strong>show</strong> printouts were generated with Arista EOS.</p>
<p>You can use any other device for which we implemented the basic <a href="https://netlab.tools/module/vxlan/#platform-support">VXLAN</a> and <a href="https://netlab.tools/module/evpn/#platform-support">EVPN</a> functionality as the lab switches. Additional limitations (if any) are listed under the <em>Device Requirements</em> section of each lab exercise.</p>
<h2 id="select-the-virtualization-environment">Select the Virtualization Environment</h2>
<p>Now that you know which network device to use, check <a href="https://netlab.tools/platforms/#supported-virtualization-providers">which virtualization environment</a> you can use. Running VXLAN/EVPN labs in a <a href="../4-codespaces/">free GitHub Codespace</a> is an excellent starting point, but if you decide to build your own infrastructure, <em>containerlab</em> is easier to set up than <em>libvirt</em>.</p>
<p>If you want to run the labs on your laptop (including <a href="https://blog.ipspace.net/2024/03/netlab-bgp-apple-silicon/">Macs with Apple silicon</a>), create a <a href="https://netlab.tools/install/ubuntu-vm/">Ubuntu VM</a> to run <em>netlab</em>. You could also run them in a VM in a private or public cloud or invest in a tiny brick of densely packed silicon (<a href="https://www.minisforum.com/">example</a>).</p>
<p>Now for a few gotchas:</p>
<ul>
<li>Your hardware and virtualization software (for example, VirtualBox or VMware Fusion) must support <em>nested virtualization</em> if you want to run virtual machines on that Ubuntu VM.</li>
<li>You don&rsquo;t need nested virtualization to run Docker containers unless you&rsquo;re using containers that run virtual machines <em>within a container</em> (the <a href="https://netlab.tools/labs/clab/#using-vrnetlab-containers"><em>vrnetlab</em> approach</a>).</li>
</ul>
<h2 id="software-installation">Software Installation</h2>
<p>Based on the choices you made, you&rsquo;ll find the installation instructions in one of these documents:</p>
<ul>
<li><a href="../4-codespaces/">Using GitHub Codespaces</a></li>
<li><a href="https://netlab.tools/install/ubuntu-vm/">Ubuntu VM Installation</a> on Windows or MacOS</li>
<li><a href="https://netlab.tools/install/ubuntu/">Ubuntu Server Installation</a></li>
<li><a href="https://netlab.tools/install/linux/">Running netlab on any other Linux Server</a></li>
<li><a href="https://netlab.tools/install/cloud/">Running netlab in a Public Cloud</a></li>
<li><a href="https://blog.ipspace.net/2024/03/netlab-bgp-apple-silicon.html">Running netlab on Apple silicon</a></li>
</ul>
<p>Once you have completed the software installation, you have to deal with the stupidities of downloading and installing network device images (<a href="https://netlab.tools/labs/libvirt/#vagrant-boxes">libvirt</a>, <a href="https://netlab.tools/labs/clab/#container-images">containers</a>) unless you decided to use Nokia SR Linux or Vyos.</p>
<p>I would love to simplify the process, but the networking vendors refuse to play along. Even worse, their licenses prohibit me from downloading the images and creating a packaged VM with preinstalled network devices for you<sup id="fnref:NPAL"><a class="footnote-ref" href="#fn:NPAL">1</a></sup>. Fortunately, you only have to go through this colossal waste of time once.</p>
<h2 id="defaults">Setting Up the Labs</h2>
<p>We finally got to the fun part &ndash; setting up the labs. If you&rsquo;re not using GitHub Codespaces:</p>
<ul>
<li>Select a directory where you want to have the VXLAN/EVPN labs</li>
<li>Clone the <code>evpn</code> <a href="https://github.com/bgplab/evpn">GitHub repository</a> with <code>git clone https://github.com/bgplab/evpn.git</code>. <a href="https://github.com/bgplab/evpn">GitHub UI</a> gives you other options in the green <code>Code</code> button, including <em>Download ZIP</em></li>
</ul>
<p>After you get a local copy of the repository:</p>
<ul>
<li>Change the directory to the top directory of the cloned repository<sup id="fnref:BLB"><a class="footnote-ref" href="#fn:BLB">2</a></sup>.</li>
<li>Verify the current project defaults with the <code>netlab defaults --project</code> command:</li>
</ul>
<pre><code>device = eos (project)
groups.external.device = frr (project)
groups.hosts.device = linux (project)
paths.plugin = ['topology:.', 'topology:../../plugin', 'package:extra'] (project)
provider = clab (project)
</code></pre>
<ul>
<li>If needed, change the project defaults to match your environment with the <code>netlab defaults --project _setting_=_value_</code> command or edit the <code>defaults.yml</code> file with a text editor like <code>vi</code> or <code>nano</code>. For example, use these commands to change your devices to Cisco Nexus OS running as virtual machines<sup id="fnref:NXOS"><a class="footnote-ref" href="#fn:NXOS">3</a></sup>:</li>
</ul>
<pre><code class="language-shell">$ netlab defaults --project device=nxos
The default setting device is already set in project defaults
Do you want to change that setting in project defaults [y/n]: y
device set to nxos in /home/user/evpn/defaults.yml

$ netlab defaults --project provider=libvirt
The default setting provider is already set in netlab,project defaults
Do you want to change that setting in project defaults [y/n]: y
provider set to libvirt in /home/user/evpn/defaults.yml
</code></pre>
<ul>
<li>A few labs have core- or external routers. The default lab setup uses FRRouting containers or virtual machines on these routers. If you want to use some other device, change that default:</li>
</ul>
<pre><code class="language-shell">$ netlab defaults --project groups.external.device=_your_device_
</code></pre>
<ul>
<li>Even if you run your devices as virtual machines, you might still want to run the attached hosts or external/core routers as containers to minimize the memory utilization. After installing Docker and containerlab with <strong>netlab install containerlab</strong>, set the <strong>provider</strong> parameter for the <strong>hosts</strong> and <strong>external</strong> groups to <strong>clab</strong>:</li>
</ul>
<pre><code class="language-shell">$ netlab defaults --project groups.hosts.provider=clab
$ netlab defaults --project groups.external.provider=clab
</code></pre>
<ul>
<li>In a terminal window, change the current directory to one of the lab directories (for example, <code>basic/1-single</code>), and execute <strong>netlab up</strong>.</li>
<li>Wait for the lab to start and use <strong>netlab connect</strong> to connect to individual lab devices</li>
<li>Have fun.</li>
<li>When you&rsquo;re done, collect the device configurations with <strong>netlab collect</strong> (if you want to save them) and shut down the lab with <strong>netlab down</strong></li>
<li>Change the current directory to another lab directory and repeat.</li>
<li>Once you run out of lab exercises, create a new one and contribute it with a pull request ;)</li>
</ul>
<div class="footnote">
<hr />
<ol>
<li id="fn:NPAL">
<p>I&rsquo;m not going to pay a lawyer to read their boilerplate stuff, and I&rsquo;m definitely not going to rely on my amateur understanding of US copyright law.&#160;<a class="footnote-backref" href="#fnref:NPAL" title="Jump back to footnote 1 in the text">&#8617;</a></p>
</li>
<li id="fn:BLB">
<p><code>evpn</code> if you used the simple version of the <strong>git clone</strong> command&#160;<a class="footnote-backref" href="#fnref:BLB" title="Jump back to footnote 2 in the text">&#8617;</a></p>
</li>
<li id="fn:NXOS">
<p>Assuming you built the <a href="https://netlab.tools/labs/nxos/">Nexus OS Vagrant box</a> first&#160;<a class="footnote-backref" href="#fnref:NXOS" title="Jump back to footnote 3 in the text">&#8617;</a></p>
</li>
</ol>
</div></div>
            </div>
        </div>

        <footer class="col-md-12">
<hr>
    <p>(C) 2025 Ivan Pepelnjak (ipSpace.net AG)</p>
        </footer>
        <script src="../js/bootstrap.bundle.min.js"></script>
        <script>
            var base_url = "..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../js/base.js"></script>
        <script src="../search/main.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
